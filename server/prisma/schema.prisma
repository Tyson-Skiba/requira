generator client {
  provider = "prisma-client-js"
  output   = "../db/prisma"
}

datasource db {
  provider = "sqlite"
}

model User {
  id                Int  @id @default(autoincrement())
  username          String @unique
  avatar            String?
  email             String
  password          String @default("")
  requiresApproval  Boolean @default(false)
  isApprover        Boolean @default(true)
  musicLibraryPath  String?
  bookLibraryPath   String?
  isAdmin           Boolean @default(false)
  canSeeFullLibrary Boolean @default(true)
  theme             String @default("light")
  api_key           String? @unique
  requestedQueues   Queue[] @relation("RequestUser")
  approvedQueues    Queue[] @relation("ApproverUser")

  activities ActivityLog[] @relation("ActionTriggerer")

  songs Song[] @ignore @relation("OwnerUserSong")
  books Book[] @ignore @relation("OwnerUserBook")
}

model Queue {
  id              Int  @id @default(autoincrement())
  type            Int
  cover           String
  data            String
  external_id     String
  request_user_id Int
  approver_user_id Int?
  created_at       DateTime @default(now())
  attempts          Int
  request_user User @relation("RequestUser", fields: [request_user_id], references: [id])
  approver_user User? @relation("ApproverUser", fields: [approver_user_id], references: [id])
}

model Song {
  id              Int       @id @default(autoincrement())
  recording_mbid  String? 
  artist_mbid     String?
  title           String
  artist          String
  album           String?
  release_date    DateTime?
  isrc            String?
  cover           String?
  filepath        String
  external_id     String
  created_at      DateTime @default(now())
  source          String?
  cache_key       Int @default(1)
  owner_user_id   Int @default(1)
  owner           User @relation("OwnerUserSong", fields: [owner_user_id], references: [id])

  @@map("songs")
}

model Book {
  id          Int       @id @default(autoincrement())
  external_id String
  authors     String?
  title       String?
  publisher   String?
  year        Int?
  pages       Int?
  language    String?
  size        String?
  extension   String?
  mirror      String?
  cover       String?
  filepath    String
  created_at  DateTime @default(now())
  cache_key   Int @default(1)

  owner_user_id   Int @default(1)
  owner           User @relation("OwnerUserBook", fields: [owner_user_id], references: [id])

  @@map("books")
}

model ActivityLog {
  id                      Int       @id @default(autoincrement())
  triggered_by_user_id    Int 
  type                    String
  details                 String
  entityId                Int?
  entityType              String?

  triggered_by            User @relation("ActionTriggerer", fields: [triggered_by_user_id], references: [id])
}

model SourceBlacklist {
  id     Int @id @default(autoincrement())
  source String @unique
}
